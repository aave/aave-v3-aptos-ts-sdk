import { AccountAddress } from "@aptos-labs/ts-sdk";
import { DEFAULT_TESTNET_CONFIG } from "../../src/configs/testnet";
import { AptosConfigurator, ReserveConfig } from "../../src/helpers";
import dotenv from "dotenv";

dotenv.config();

const eModes = [
  {
    categoryId: 1,
    ltv: 9000,
    liquidationThreshold: 9300,
    liquidationBonus: 10200,
    oracle: AccountAddress.ZERO,
    label: "ETH correlated",
  },
  {
    categoryId: 2,
    ltv: 9500,
    liquidationThreshold: 9700,
    liquidationBonus: 10100,
    oracle: AccountAddress.ZERO,
    label: "Stablecoins",
  },
];

const reserves: ReserveConfig[] = [
  {
    name: "Wrapped Ether",
    symbol: "WETH",
    decimals: 18,
    ltv: 8050n,
    liquidationThreshold: 8300n,
    liquidationBonus: 10500n,
    reserveFactor: 1500n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 310944430000n,
    variableRateSlope1: 27000000000000000000000000n,
    variableRateSlope2: 800000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 900000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 1800000n,
    supplyCap: 2000000n,
    borrowableInIsolation: false,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos WETH",
    aTokenSymbol: "aWETH",
    variableDebtTokenName: "Aave Aptos WETH Variable Debt",
    variableDebtTokenSymbol: "vWETH",
    eModeCategoryId: 1,
    maxSupply: 0n,
  },
  {
    name: "Wrapped liquid staked Ether 2.0",
    symbol: "wstETH",
    decimals: 18,
    ltv: 7850n,
    liquidationThreshold: 8100n,
    liquidationBonus: 10600n,
    reserveFactor: 500n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 368570378907n,
    variableRateSlope1: 20000000000000000000000000n,
    variableRateSlope2: 800000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 450000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 48000n,
    supplyCap: 1250000n,
    borrowableInIsolation: false,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos wstETH",
    aTokenSymbol: "awstETH",
    variableDebtTokenName: "Aave Aptos wstETH Variable Debt",
    variableDebtTokenSymbol: "vwstETH",
    eModeCategoryId: 1,
    maxSupply: 0n,
  },
  {
    name: "Wrapped BTC",
    symbol: "WBTC",
    decimals: 8,
    ltv: 7300n,
    liquidationThreshold: 7800n,
    liquidationBonus: 10500n,
    reserveFactor: 2000n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 9206272656429n,
    variableRateSlope1: 40000000000000000000000000n,
    variableRateSlope2: 3000000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 450000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 28000n,
    supplyCap: 43000n,
    borrowableInIsolation: false,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos WBTC",
    aTokenSymbol: "aWBTC",
    variableDebtTokenName: "Aave Aptos WBTC Variable Debt",
    variableDebtTokenSymbol: "vWBTC",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
  {
    name: "USD Coin",
    symbol: "USDC",
    decimals: 6,
    ltv: 7500n,
    liquidationThreshold: 7800n,
    liquidationBonus: 10450n,
    reserveFactor: 1000n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 99994013n,
    variableRateSlope1: 55000000000000000000000000n,
    variableRateSlope2: 600000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 920000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 2100000000n,
    supplyCap: 2250000000n,
    borrowableInIsolation: true,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos USDC",
    aTokenSymbol: "aUSDC",
    variableDebtTokenName: "Aave Aptos USDC Variable Debt",
    variableDebtTokenSymbol: "vUSDC",
    eModeCategoryId: 2,
    maxSupply: 0n,
  },
  {
    name: "Dai Stablecoin",
    symbol: "DAI",
    decimals: 18,
    ltv: 6300n,
    liquidationThreshold: 7700n,
    liquidationBonus: 10500n,
    reserveFactor: 2500n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 99987700n,
    variableRateSlope1: 55000000000000000000000000n,
    variableRateSlope2: 750000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 920000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 271000000n,
    supplyCap: 338000000n,
    borrowableInIsolation: true,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos DAI",
    aTokenSymbol: "aDAI",
    variableDebtTokenName: "Aave Aptos DAI Variable Debt",
    variableDebtTokenSymbol: "vDAI",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
  {
    name: "ChainLink Token",
    symbol: "LINK",
    decimals: 18,
    ltv: 6600n,
    liquidationThreshold: 7100n,
    liquidationBonus: 10700n,
    reserveFactor: 2000n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 1452694000n,
    variableRateSlope1: 70000000000000000000000000n,
    variableRateSlope2: 3000000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 450000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 13000000n,
    supplyCap: 15000000n,
    borrowableInIsolation: false,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos LINK",
    aTokenSymbol: "aLINK",
    variableDebtTokenName: "Aave Aptos LINK Variable Debt",
    variableDebtTokenSymbol: "vLINK",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
  {
    name: "Aave Token",
    symbol: "AAVE",
    decimals: 18,
    ltv: 6600n,
    liquidationThreshold: 7300n,
    liquidationBonus: 10750n,
    reserveFactor: 0n,
    borrowingEnabled: false,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 16041345840n,
    variableRateSlope1: 70000000000000000000000000n,
    variableRateSlope2: 3000000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 450000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 0n,
    supplyCap: 1850000n,
    borrowableInIsolation: false,
    flashloanEnabled: false,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos AAVE",
    aTokenSymbol: "aAAVE",
    variableDebtTokenName: "Aave Aptos AAVE Variable Debt",
    variableDebtTokenSymbol: "vAAVE",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
  {
    name: "LUSD Stablecoin",
    symbol: "LUSD",
    decimals: 18,
    ltv: 0n,
    liquidationThreshold: 7700n,
    liquidationBonus: 10450n,
    reserveFactor: 2000n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 99625300n,
    variableRateSlope1: 55000000000000000000000000n,
    variableRateSlope2: 870000000000000000000000000n,
    baseVariableBorrowRate: 0n,
    optimalUsageRatio: 800000000000000000000000000n,
    paused: false,
    debtCeiling: 0n,
    borrowCap: 8000000n,
    supplyCap: 18000000n,
    borrowableInIsolation: true,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos LUSD",
    aTokenSymbol: "aLUSD",
    variableDebtTokenName: "Aave Aptos LUSD Variable Debt",
    variableDebtTokenSymbol: "vLUSD",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
  {
    name: "Curve DAO Token",
    symbol: "CRV",
    decimals: 18,
    ltv: 3500n,
    liquidationThreshold: 4100n,
    liquidationBonus: 10830n,
    reserveFactor: 3500n,
    borrowingEnabled: true,
    active: true,
    freezed: false,
    priceInMarketReferenceCurrency: 40351714n,
    variableRateSlope1: 140000000000000000000000000n,
    variableRateSlope2: 3000000000000000000000000000n,
    baseVariableBorrowRate: 30000000000000000000000000n,
    optimalUsageRatio: 700000000000000000000000000n,
    paused: false,
    debtCeiling: 100000000n,
    borrowCap: 7000000n,
    supplyCap: 17250000n,
    borrowableInIsolation: false,
    flashloanEnabled: true,
    iconUri: "",
    projectUri: "",
    treasury: AccountAddress.ZERO,
    aTokenName: "Aave Aptos CRV",
    aTokenSymbol: "aCRV",
    variableDebtTokenName: "Aave Aptos CRV Variable Debt",
    variableDebtTokenSymbol: "vCRV",
    eModeCategoryId: 0,
    maxSupply: 0n,
  },
];

(async () => {
  const aptosConfigurator = new AptosConfigurator(
    DEFAULT_TESTNET_CONFIG,
    process.env.POOL_PRIVATE_KEY || "",
    process.env.MOCK_ORACLE_PRIVATE_KEY || "",
    process.env.UNDERLYING_TOKENS_PRIVATE_KEY || "",
    process.env.MNEMONIC || "",
  );
  await aptosConfigurator.setupProtocol(reserves, eModes);
})();
